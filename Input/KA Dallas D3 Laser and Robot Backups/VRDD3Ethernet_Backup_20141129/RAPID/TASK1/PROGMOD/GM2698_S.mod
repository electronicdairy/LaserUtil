MODULE GM2698_S
!*******************************************************************
	!Cell S robot targets
	!*******************************************************************
	!Cell S Tool Pads Position
	TASK PERS wobjdata wobj_S_GM2:=[FALSE,TRUE,"",[[0,0,0],[1,0,0,0]],[[1558.96,-65.9665,212.359],[0.698244,0.00742378,-0.00733323,-0.715784]]];
	
    CONST robtarget pGM2698Tool_S_X1_GM2:=[[1569.77,370.10,212.54],[0.524519,-0.00145593,-0.00420836,0.851387],[0,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pGM2698Tool_S_X2_GM2:=[[1550.13,-421.65,212.23],[0.979702,5.59241E-05,-0.0001349,0.200461],[-1,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pGM2698Tool_S_Y1_GM2:=[[2063.88,-78.49,223.03],[0.711101,8.95287E-05,7.29535E-05,0.70309],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	
	!Weld Position
	CONST robtarget pS_400_1_GM2:=[[-480.14,398.20,140.23],[0.38196,-0.00403484,-0.010508,-0.92411],[0,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_400_2_GM2:=[[-71.31,389.66,134.30],[6.0909E-06,-0.000325934,0.0111401,0.999938],[0,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_400_3_GM2:=[[-71.44,217.06,200.40],[0.0257665,-5.0348E-05,-0.00930921,-0.999625],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_400_4_GM2:=[[-486.22,226.75,196.63],[0.29334,-0.00955942,-0.00881076,-0.95592],[0,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_400_5_GM2:=[[-64.48,417.14,116.46],[0.000281939,-0.00236368,0.184085,-0.982907],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_400_6_GM2:=[[-64.48,417.14,116.46],[0.000281939,-0.00236368,0.184085,-0.982907],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_400_7_GM2:=[[-64.48,417.14,116.46],[0.000281939,-0.00236368,0.184085,-0.982907],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_400_8_GM2:=[[-64.48,417.14,116.46],[0.000281939,-0.00236368,0.184085,-0.982907],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_405_1_GM2:=[[-71.30,389.66,134.30],[6.24336E-06,-0.000327522,0.0111424,0.999938],[0,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_405_2_GM2:=[[354.61,421.21,138.01],[0.172518,-0.00222319,0.0110413,0.984942],[-1,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_405_3_GM2:=[[398.63,204.54,201.72],[0.0553338,-0.000811806,0.00935338,0.998424],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_405_4_GM2:=[[-71.44,217.06,200.40],[0.0257672,-5.036E-05,-0.00930959,-0.999625],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_405_5_GM2:=[[-64.48,417.14,116.46],[0.000281939,-0.00236368,0.184085,-0.982907],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_405_6_GM2:=[[-64.48,417.14,116.46],[0.000281939,-0.00236368,0.184085,-0.982907],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_405_7_GM2:=[[-64.48,417.14,116.46],[0.000281939,-0.00236368,0.184085,-0.982907],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_405_8_GM2:=[[-64.48,417.14,116.46],[0.000281939,-0.00236368,0.184085,-0.982907],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_420_6_GM2:=[[-315.07,-10.73,293.28],[0.00708116,-0.00359767,0.301657,-0.953384],[0,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_420_7_GM2:=[[-72.44,-2.51,296.02],[0.00708451,-0.00367191,0.301183,-0.953533],[0,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_420_8_GM2:=[[171.91,2.89,297.42],[0.00714322,-0.00369832,0.300267,-0.953821],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_420_9_GM2:=[[-435.80,63.21,104.63],[0.129377,-0.0444378,-0.0881638,-0.986668],[0,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_Tool_Top30:=[[1990.49,-197.74,252.08],[0.707016,-0.00633634,-0.0063405,0.70714],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_Tool_Top40:=[[2095.24,235.86,254.46],[0.713556,-0.00630075,-0.00645369,0.70054],[0,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_Tool_Top50:=[[1992.26,313.46,252.08],[0.707015,-0.0063378,-0.00633755,0.707141],[0,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST string timetest:="";
CONST robtarget pS_405_2_GM12:=[[407.37,375.02,139.15],[0.172501,-0.00226682,0.0110013,0.984945],[-1,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];

    
	CONST robtarget pS_400_1_GM12:=[[-525.84,401.43,149.83],[0.171218,-0.00167035,-0.0127783,-0.985149],[0,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_405_2_GM22:=[[370.33,416.13,145.31],[0.194915,-0.00527484,0.0128961,0.980721],[-1,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_405_2_GM32:=[[335.05,32.24,196.75],[0.195478,-0.00434208,0.00949177,0.980652],[-1,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_420_1_GM12:=[[398.03,36.89,196.59],[0.378403,-0.00602591,0.00849891,0.925582],[-1,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_420_2_GM12:=[[125.63,26.26,196.69],[0.369192,-0.00597129,0.00857184,0.929294],[0,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_420_3_GM12:=[[-68.53,27.19,196.77],[0.00664506,0.00230733,-0.0101558,-0.999923],[0,0,-1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_420_4_GM12:=[[-255.15,13.93,196.95],[0.376357,-0.00160363,-0.0102852,-0.926416],[-1,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	CONST robtarget pS_420_5_GM12:=[[-528.12,25.10,196.77],[0.39395,-0.0018051,-0.0102707,-0.919072],[0,-1,0,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
	
	
	
	PROC rGM2698_S_Welding()
			!Sub station welding program
			SetGO TaskActive, 3;
			PulseDO\PLength:=2.0, WeldStarted;
			!
			ClkReset clock_Sub_Weld_Cycle;
			ClkStart clock_Sub_Weld_Cycle;
			PulseDO\PLength:=2.0, OpenCellSInnerCover;
			DeactUnit STN1;
			DeactUnit STN2;
		IF RobotProduction = 1 THEN
			vProduction := [7500,7500,7500,180];
			vHome := [2500, 2500, 2500, 90];
	  	ELSE
			vProduction := [200,100,100,10];
			vHome := [100, 100, 100, 10];
	  	ENDIF
		
			!Safe Move Robot 
			MoveJ pS_safe_Enter, vProduction, z50, t3D_PFO\WObj:=wobj0;
			!Wait Cell S Inner Door Opened
			WaitDI CellSInnerCoverOpened, 1;
			!
			!SpyStart "HOME:/timetest.log";
		
			
			!
			AccSet 100,100;
			Set PFOAirJet;
			Set LaserRequest;
			PulseDO\PLength:=2.0, WeldStarted;
			!
			MoveL pS_Tool_Top, vProduction, z100, t3D_PFO\WObj:=wobj0;
			
			!
		IF	SS400PP = 1 And TS400POS1 =1 Then  
			!
			SetGO LaserProgReq, 141;
			MoveJ pS_400_1_GM12, vPRODUCTION, fine, t3D_PFO\WObj:=wobj_S_GM2;
			rPFO_Dimpling;
			
            SetGO LaserProgReq, 131;
			MoveJ pS_400_2_GM2, vProduction, fine, t3D_PFO\WObj:=wobj_S_GM2;
			rPFO_Dimpling;
			
		ENDIF
		!
		IF	SS405PP = 1 And TS405POS1 =1 Then 
			
			SetGO LaserProgReq, 142;
			MoveJ pS_405_2_GM22, vPRODUCTION, fine, t3D_PFO\WObj:=wobj_S_GM2;
			rPFO_Dimpling;
			!
		ENDIF
        
        
		IF	SS400PP = 1 OR SS405PP =1 Then 
            
		    Set TS400_405TILT;   !!! TS400 and 405 POS 2 REQUESTED;
            MoveJ pS_405_3_GM2, vProduction, fine, t3D_PFO\WObj:=wobj_S_GM2;
            
       ENDIF
            !
        IF	SS400PP = 1 OR SS405PP =1 Then 
		   
            WaitDI TS400POS2,1;  
	        WaitDI TS405POS2,1;
            
        ENDIF
            
            IF	SS405PP = 1 and TS405POS2 = 1 Then  !!!   TS405PP = 1 and TS400_405_ROTATED = 1 Then
			
			SetGO LaserProgReq, 144;
			MoveJ pS_405_3_GM2, vProduction, fine, t3D_PFO\WObj:=wobj_S_GM2;
			rPFO_Dimpling;
			
		ENDIF
            
			IF	SS420PP = 1 THEN !!!  TS420PP = 1 Then
			
            SetGO LaserProgReq, 145;
			MoveJ pS_420_1_GM12, vPRODUCTION, fine, t3D_PFO\WObj:=wobj_GM2694_96_S_GM2;
			rPFO_Dimpling;
			
            SetGO LaserProgReq, 146;
			MoveJ pS_420_2_GM12, vPRODUCTION, fine, t3D_PFO\WObj:=wobj_GM2694_96_S_GM2;
			rPFO_Dimpling;
			!
			SetGO PFOProgReq, 248;
			SetGO LaserProgReq, 140;
			MoveJ pS_420_3_GM12, vPRODUCTION, fine, t3D_PFO\WObj:=wobj_GM2694_96_S_GM2;
			rPFO_Dimpling;
			
            ENDIF
            
            
          IF	SS400PP = 1 and TS400POS2 = 1 Then
			
			SetGO PFOProgReq, 277;
			SetGO LaserProgReq, 140;
			MoveJ pS_400_3_GM2, vProduction, fine, t3D_PFO\WObj:=wobj_S_GM2;
			rPFO_Dimpling;
			
		ENDIF
	  
        IF	SS420PP = 1 THEN 
            
			SetGO LaserProgReq, 148;
			MoveJ pS_420_4_GM12, vPRODUCTION, fine, t3D_PFO\WObj:=wobj_GM2694_96_S_GM2;
			rPFO_Dimpling;
			!
			SetGO LaserProgReq, 152;
			MoveJ pS_420_5_GM12, vPRODUCTION, fine, t3D_PFO\WObj:=wobj_GM2694_96_S_GM2;
			rPFO_Dimpling;
            
		ENDIF
		    	
		IF	SS400PP = 1 and TS400POS2 = 1 Then
			
			SetGO LaserProgReq, 143;
			MoveJ pS_400_4_GM2, vProduction, fine, t3D_PFO\WObj:=wobj_S_GM2;
			rPFO_Dimpling;
			
		ENDIF
	
		    Reset TS400_405TILT; 

			AccSet 100,100;
			!
			PulseDO\PLength:=2.0, WeldCompleted;
			Reset PFOAirJet;
			Reset LaserRequest;
			WaitDI CellSInnerCoverOpened, 1;
			MoveJ pS_Tool_Top, vProduction, z100, t3D_PFO\WObj:=wobj0;
			MoveL pS_Safe_Enter, vProduction, z50, t3D_PFO\WObj:=wobj0;
			MoveAbsJ j_Robot_Home\NoEOffs,vProduction,fine,t3D_PFO\WObj:=wobj0;

			PulseDO\PLength:=2.0, CloseCellSInnerCover;
			WaitTime 0.2;
			SetGO TaskActive, 0;
			!
			ClkStop clock_Sub_Weld_cycle;
			TPWrite "SUB Welding Cycle Time (ms) = " \Num:= ClkRead(clock_Sub_Weld_cycle)*1000;
			nSub_Weld_Cycle_Time:= ClkRead(clock_Sub_Weld_cycle)*1000;
		Return;
		
	ENDPROC
	
ENDMODULE